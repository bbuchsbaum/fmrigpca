% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parcel.R
\name{build_spatial_metric_parcel}
\alias{build_spatial_metric_parcel}
\title{Build parcel-level spatial column metric A from aggregated tissues and Laplacian}
\usage{
build_spatial_metric_parcel(
  gm_p,
  wm_p,
  csf_p,
  Lp,
  tsnr_p = NULL,
  alpha = 1,
  beta = 0.5,
  gamma = 1,
  lambda_s = 0.5,
  tau = 1e-06
)
}
\arguments{
\item{gm_p, wm_p, csf_p}{Numeric vectors of length P with parcel tissue values
(typically means of voxel-wise tissue probabilities within each parcel).}

\item{Lp}{Parcel Laplacian (P x P) from \code{make_parcel_laplacian()}.}

\item{tsnr_p}{Optional parcel tSNR vector from \code{compute_tsnr_parcel()}.}

\item{alpha}{Exponent for GM weighting (default 1.0). Higher values give more
weight to gray matter parcels.}

\item{beta}{Exponent for tSNR weighting (default 0.5). Controls influence of
temporal signal quality.}

\item{gamma}{Exponent for (WM+CSF) down-weighting (default 1.0). Higher values
penalize non-gray matter more strongly.}

\item{lambda_s}{Spatial regularization weight (default 0.5). Controls the
strength of spatial smoothing via the Laplacian.}

\item{tau}{Small ridge on the diagonal (default 1e-6) for numerical stability.}
}
\value{
Symmetric positive definite \code{Matrix} (P x P).
}
\description{
Forms a parcel-level spatial metric \code{A} analogous to voxel-level \code{build_spatial_metric},
using aggregated tissue probabilities and optional parcel tSNR.
}
\details{
Constructs weights \code{w = gm^alpha * tsnr^beta * (wm + csf)^{-gamma}} for each
parcel, then forms \code{A = diag(sqrt(w)) * (I + lambda_s * Lp) * diag(sqrt(w)) + tau * I}.
This encodes both spatial smoothness (via the Laplacian) and parcel-wise
quality weights derived from tissue composition and temporal SNR. The result
is a positive definite metric suitable for generalized PCA.
}
\examples{
\dontrun{
# Build parcel column metric with tissue weights and spatial smoothing
A <- build_spatial_metric_parcel(gm_p, wm_p, csf_p, Lp, tsnr_p = tsnr_vals,
                                 lambda_s = 0.5)
}

}
\seealso{
\code{\link[=build_spatial_metric]{build_spatial_metric()}} for voxel-level column metric construction

Other spatial metrics: 
\code{\link{build_spatial_metric}()},
\code{\link{compute_tsnr}()},
\code{\link{compute_tsnr_parcel}()},
\code{\link{make_laplacian}()},
\code{\link{make_parcel_laplacian}()}
}
\concept{spatial metrics}
