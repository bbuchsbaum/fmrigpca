% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/parcel.R
\name{fit_subject_genpca_parcel}
\alias{fit_subject_genpca_parcel}
\title{Fit generalized PCA at the parcel level (ClusteredNeuroVec)}
\usage{
fit_subject_genpca_parcel(
  cnv_list,
  parc_vol = NULL,
  parcel_coords = NULL,
  adjacency = NULL,
  gm_vol = NULL,
  wm_vol = NULL,
  csf_vol = NULL,
  gm_p = NULL,
  wm_p = NULL,
  csf_p = NULL,
  wm_parcels = NULL,
  FD_list = NULL,
  DVARS_list = NULL,
  k = 20,
  p_ar = 1L,
  lambda_s = 0.5,
  lambda_t = 0.3,
  knn_k = 6,
  knn_sigma = 2.5
)
}
\arguments{
\item{cnv_list}{List of \code{ClusteredNeuroVec} runs.}

\item{parc_vol, parcel_coords, adjacency}{Ways to define the parcel graph:
provide exactly one.}

\item{gm_vol, wm_vol, csf_vol}{Optional tissue maps used if \code{gm_p/wm_p/csf_p}
are not provided.}

\item{gm_p, wm_p, csf_p}{Optional parcel-level tissue summaries (avoids
recomputation).}

\item{wm_parcels}{Optional WM parcel indices for AR whitener estimation.}

\item{FD_list, DVARS_list}{Optional lists of per-run motion metrics.
Each list should contain numeric vectors (one per run in cnv_list).
FD is framewise displacement (mm), DVARS is temporal derivative of
signal variance. Used to down-weight high-motion frames. See
\code{\link{make_frame_weights}} for detailed definitions of these metrics.}

\item{k}{Number of components to extract (default 20).}

\item{p_ar}{AR order for temporal whitening (default 1).}

\item{lambda_s}{Spatial regularization weight (default 0.5).}

\item{lambda_t}{Temporal regularization weight (default 0.3).}

\item{knn_k}{Number of nearest neighbors for parcel graph (default 6).}

\item{knn_sigma}{Gaussian kernel bandwidth for parcel graph (default 2.5).}
}
\value{
A \code{genpca} object with parcel-level loadings.
}
\description{
Builds a parcel Laplacian and parcel-level \code{A}/\code{M} metrics then fits genpca
on stacked runs. See voxel-level \code{fit_subject_genpca()} for an overview.
}
\details{
This is the parcel-level analogue of \code{fit_subject_genpca()}, operating on
\code{ClusteredNeuroVec} data where voxels have been aggregated into parcels.
The workflow is:
\enumerate{
\item Build parcel graph Laplacian from adjacency, coordinates, or labels
\item Compute parcel tSNR across runs
\item Aggregate tissue maps to parcels (if not provided)
\item Construct column metric A with spatial and tissue weights
\item Build per-run row metrics M with AR whitening and motion weights
\item Stack runs temporally and fit generalized PCA
}
Parcellation reduces dimensionality and computation while preserving
spatial structure through the parcel graph.
}
\examples{
\dontrun{
# Fit genpca on parcellated data with tissue weights
fit <- fit_subject_genpca_parcel(cnv_list, parc_vol = parcellation,
                                 gm_vol = gm, wm_vol = wm, csf_vol = csf,
                                 k = 20)
}

}
\seealso{
\code{\link[=fit_subject_genpca]{fit_subject_genpca()}} for voxel-level analysis

Other main fitting: 
\code{\link{fit_subject_genpca}()},
\code{\link{fit_subject_metapca}()}
}
\concept{main fitting}
